# TESTS

## T-001: SPA骨組みとTailwindベースUI

### 実行済みチェック
- `npm run build`
  - 期待結果: 本番ビルドが成功し、`dist/` が生成される。
  - 実績: 成功。`dist/index.html` とアセットが生成された。
- `npm run lint`
  - 期待結果: `src/main.ts` のLintエラーが0件。
  - 実績: 成功。エラー0件。

### 回帰防止テストケース（手動）
1. 画面表示時に単一ページ内に「入力設定」「プレビュー」「履歴（最大10件）」が同時表示される。
2. 入力設定内に以下の操作要素が存在する。
   - 上枠テキスト
   - 日付
   - 下枠テキスト
   - 日付フォーマット（和暦/西暦）
   - 日付区切り文字
   - 書体
   - テキスト色
   - 枠線太さ
   - 枠線色
   - PNG透過背景トグル
   - PNGダウンロードボタン
   - SVGダウンロードボタン
3. プレビュー領域に `reference-layout.svg` が表示される。
4. レイアウトがTailwindの余白・配色により可読性を確保している（背景/カード/入力コントラストが識別可能）。

## T-002: Canvas印影レンダリングエンジン

### 実行済みチェック
- `npm run test -- drawStamp`
  - 期待結果: `drawStamp` と `createStampLayout` のユニットテストが成功する。
  - 実績: 成功。外周円・内部2本線・3領域テキスト描画の呼び出し検証、およびレイアウト座標算出検証をパス。
- `npm run build`
  - 期待結果: 描画モジュール追加後も本番ビルドが成功する。
  - 実績: 成功。`dist/` 生成を確認。
- `npm run lint`
  - 期待結果: 追加した描画ロジックおよびテストコードでLintエラーがない。
  - 実績: 成功。エラー0件。

### 回帰防止テストケース（手動）
1. 初期表示時、Canvasに外周円・内部2本線・上段/中段/下段テキストが描画されている。
2. 上枠テキスト・下枠テキストの入力値変更時、対応する領域テキストが即時更新される。
3. 日付入力変更時、中段テキストが即時更新される。
4. 枠線色・枠線太さ変更時、外周円と内部2本線の見た目が即時更新される。
5. 書体変更時、3領域テキストが同一書体系で再描画される。

### 追加回帰ケース（reference-layout.svg一致性）
6. 初期表示のCanvasプレビューで、外周太線円・内周細線円・横線2本の位置関係が `reference-layout.svg`（viewBox 300x300）と一致する。
7. 上段/中段/下段テキストの基準Y座標がそれぞれ 70 / 150 / 240（300基準）に一致する。

### 追加回帰ケース（ストローク太さ・日本語グリフ）
8. 既定値（枠線太さ3px）で描画した際、外周線が6px・内周線および横線が3px相当で表示され、`reference-layout.svg` の `--base-stroke: 3` 構成と一致する。
9. 初期値として上枠「田中」・下枠「一郎」が表示される。
10. ドキュメント言語が `ja-JP` で、CJKグリフ描画時に日本語フォント優先スタック（Noto/Hiragino/Yu）が利用される。

## T-003: 日付フォーマット（和暦/西暦・区切り）実装

### 実行済みチェック
- `npm run test -- formatDate`
  - 期待結果: `formatDateText` と `toJapaneseEra` のユニットテストが成功する。
  - 実績: 成功。和暦境界日（令和開始日・平成開始日前日）と区切りフォーマット適用の検証をパス。
- `npm run build`
  - 期待結果: 日付フォーマットモジュール追加後も本番ビルドが成功する。
  - 実績: 成功。`dist/` 生成を確認。
- `npm run lint`
  - 期待結果: 追加した日付モジュールおよびUI連携コードでLintエラーがない。
  - 実績: 成功。エラー0件。

### 回帰防止テストケース（手動）
1. 日付フォーマットを「西暦」にすると、中央領域の日付が `YYYY/MM/DD`（または指定区切り）で表示される。
2. 日付フォーマットを「和暦」に切り替えると、中央領域の日付が `令和N/MM/DD` 形式（元年は `元`）で表示される。
3. 日付区切り文字を `/`・`-`・`.`・`年/月/日` に変更すると、中央領域表示へ即時反映される。
4. 日付区切り文字入力欄に任意文字列を入力すると、その区切りで日付表示が更新される（自由入力）。
5. 日付入力が空の場合、中段日付テキストは空表示になる。

## T-004: 書体・文字サイズ制御と枠線カスタマイズ実装

### 実行済みチェック
- `npm run test -- textStyle`
  - 期待結果: `textStyle` ユーティリティのユニットテストが成功する。
  - 実績: 成功。フォント解決、文字サイズ倍率クランプ、自動縮小処理を検証。
- `npm run test -- drawStamp`
  - 期待結果: `drawStamp` の既存描画テストが成功し、回帰がない。
  - 実績: 成功。円・線・テキスト描画呼び出しの検証をパス。
- `npm run build`
  - 期待結果: 文字サイズ制御を追加後も本番ビルドが成功する。
  - 実績: 成功。`dist/` 生成を確認。
- `npm run lint`
  - 期待結果: 追加した描画/スタイル制御コードでLintエラーがない。
  - 実績: 成功。エラー0件。

### 回帰防止テストケース（手動）
1. 書体を「明朝体」「ゴシック体」で切り替えると、上段/中段/下段の全テキストに同一書体が一括反映される。
2. 文字サイズ倍率を `0.5`〜`2.0` の範囲で変更すると、3領域テキストサイズが即時更新される。
3. 長文（例: 上枠に10文字以上）を入力しても、テキストが印影内に収まるよう自動縮小される。
4. 枠線太さを変更すると、外周円および内部線の太さが即時反映される。
5. 枠線色を変更すると、外周円および内部線の色が即時反映される。

## T-005: PNG/SVGダウンロード機能と透過背景対応

### 実行済みチェック
- `npm run test -- export`
  - 期待結果: `exportPng` / `exportSvg` のユニットテストが成功する。
  - 実績: 成功。PNG透過/白背景合成・SVGマークアップ生成・Blob URLダウンロード処理を検証。
- `npm run build`
  - 期待結果: エクスポート機能追加後も本番ビルドが成功する。
  - 実績: 成功。`dist/` 生成を確認。
- `npm run lint`
  - 期待結果: 追加したエクスポート処理およびUI連携コードでLintエラーがない。
  - 実績: 成功。エラー0件。
- `rg -n "透過背景|ダウンロード形式|PNG|SVG|exportPng|exportSvg|transparentBg|ダウンロード" SPEC.md src/main.ts src/export/exportPng.ts src/export/exportSvg.ts`
  - 期待結果: 仕様記載（SPEC.md 4.1/6.2/7.9/7.10/7.11）と実装コードのトレーサビリティを確認できる。
  - 実績: 成功。PNG透過背景、PNG/SVGダウンロード、UI操作要素と出力処理の対応を確認。

### 回帰防止テストケース（手動）
1. 「PNGを透過背景で出力」をOFFにしてPNGダウンロードすると、背景が白で保存される。
2. 「PNGを透過背景で出力」をONにしてPNGダウンロードすると、背景が透明で保存される。
3. フォーム値（上段/日付/下段、書体、色、線幅）を変更後にPNGをダウンロードすると、プレビューと同じ内容が保存される。
4. フォーム値を変更後にSVGをダウンロードすると、円・2本線・3領域テキストを含む同等構造が保存される。
5. SVG出力で`&`や`<`を含む文字列を設定しても、ファイルが壊れず表示できる（XMLエスケープ）。
